generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Districts {
  id             Int      @id @default(autoincrement())
  code           String   @unique @db.Char(3)
  name           String   @db.VarChar(100)
  slug           String   @db.VarChar(100)
  type           String   @db.VarChar(50)
  name_with_type String   @db.VarChar(150)
  path           String?
  path_with_type String?
  province_code  String   @db.Char(2)

  province Provinces @relation(fields: [province_code], references: [code]) // Quan hệ N-1 với Provinces
  wards    Wards[] // Quan hệ 1-N với bảng wards
  customers Customer[] // Quan hệ 1-N với bảng customers

  @@index([province_code])
  @@map("districts")
}

model Provinces {
  id             Int      @id @default(autoincrement())
  code           String   @unique @db.Char(2)
  name           String   @db.VarChar(100)
  slug           String   @db.VarChar(100)
  type           String   @db.VarChar(50)
  name_with_type String   @db.VarChar(150)
  sort_order     Int?
  lat            Float?
  long           Float?
  image          String?  @db.Text


  districts Districts[] // Quan hệ 1-N với bảng districts
  customers Customer[] // Quan hệ 1-N với bảng customers

  @@index([code])
  @@index([name])
  @@index([slug])
  @@index([type])
  @@index([name_with_type])
  @@index([sort_order])
  @@map("provinces")
}

// ============================================
// LOCATIONS MODULE - Wards
// ============================================

model Wards {
  id             Int      @id @default(autoincrement())
  code           String   @unique @db.Char(5)
  name           String   @db.VarChar(100)
  slug           String   @db.VarChar(100)
  type           String   @db.VarChar(50)
  name_with_type String   @db.VarChar(150)
  path           String?
  path_with_type String?
  district_code  String   @db.Char(3)

  district Districts @relation(fields: [district_code], references: [code]) // Quan hệ N-1 với Districts
  customers Customer[] // Quan hệ 1-N với bảng customers
  
  @@index([code])
  @@index([name])
  @@index([slug])
  @@index([type])
  @@index([name_with_type])
  @@index([path])
  @@index([path_with_type])
  @@index([district_code])
  @@map("wards")
}

model Customer {
  id              Int       @id @default(autoincrement()) @map("id") // ID khách hàng
  uuid            String    @unique @map("uuid") @db.Char(36) // UUID khách hàng
  customerCode    String    @map("customer_code") @db.Char(50) // Mã khách hàng
  firstName       String?   @map("first_name") @db.VarChar(255) // Tên khách hàng
  lastName        String?   @map("last_name") @db.VarChar(255) // Họ khách hàng
  fullName        String    @map("full_name") @db.VarChar(255) // Tên đầy đủ khách hàng
  avatarUrl       String?   @map("avatar_url") @db.Text // Ảnh đại diện khách hàng
  email           String    @unique @map("email") @db.VarChar(100) // Email khách hàng
  address         String?   @map("address") @db.Text // Địa chỉ khách hàng
  gender          String?   @map("gender") @db.VarChar(10) // Giới tính khách hàng
  typeRegister    String    @map("type_register") @db.VarChar(10) // Loại đăng ký khách hàng
  password        String?   @map("password") @db.VarChar(255) // Mật khẩu khách hàng
  phoneNumber     String?   @map("phone_number") @db.VarChar(20) // Số điện thoại khách hàng
  dateOfBirth     DateTime? @map("date_of_birth") @db.Date // Ngày sinh khách hàng
  loyaltyPoints   Int       @default(0) @map("loyalty_points") // Điểm thưởng khách hàng
  customerGroupId Int?      @map("customer_group_id") // Nhóm khách hàng
  googleId        String?   @map("google_id") @db.Char(255) // Google ID khách hàng
  facebookId      String?   @map("facebook_id") @db.Char(255) // Facebook ID khách hàng
  provinceId      Int?      @map("province_id") // ID tỉnh thành khách hàng
  districtId      Int?      @map("district_id") // ID huyện khách hàng
  wardId          Int?      @map("ward_id") // ID xã phường khách hàng
  otpCode         String?   @map("otp_code") @db.VarChar(10) // Mã OTP khách hàng

  province Provinces? @relation(fields: [provinceId], references: [id]) // Quan hệ N-1 với Provinces
  district Districts? @relation(fields: [districtId], references: [id]) // Quan hệ N-1 với Districts
  ward     Wards?     @relation(fields: [wardId], references: [id]) // Quan hệ N-1 với Wards

  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6) // Ngày tạo khách hàng

  @@index([id])
  @@index([customerCode])
  @@index([fullName])
  @@index([provinceId])
  @@index([districtId])
  @@index([wardId])
  @@map("customers")
}

model Department {
    id              Int      @id @default(autoincrement()) @map("id") // ID phòng ban
    uuid            String   @unique @map("uuid") @db.Char(36) // UUID phòng ban
    code            String   @unique @map("code") // Ví dụ: "SALES", "WAREHOUSE", "ACCOUNTING"
    name            String   @map("name") // Ví dụ: "Phòng Kinh Doanh", "Phòng Kho"


    employees Employee[] @relation("DepartmentEmployees") // Quan hệ với bảng Employee nhiều-nhiều 1 phòng ban có nhiều nhân viên
    
    @@map("departments")
}

model  Employee {
    id            Int       @id @default(autoincrement()) @map("id") // ID nhân viên
    uuid          String    @unique @map("uuid") @db.Char(36) // UUID nhân viên
    code          String    @unique @map("code") @db.Char(50) // Mã nhân viên
    fullName      String    @map("full_name") @db.VarChar(255) // Tên đầy đủ nhân viên
    password      String    @map("password") @db.VarChar(255) // Mật khẩu nhân viên
    email         String    @unique @map("email") @db.VarChar(100) // Email nhân viên
    phoneNumber   String?   @map("phone") @db.VarChar(20) // Số điện thoại nhân viên
    isActive    Boolean  @default(true) @map("is_active") // Trạng thái hoạt động của nhân viên


   // Quan hệ với Position 1-nhân viên thuộc về 1 chức vụ
    positionId   Int        @map("position_id")
    position     Position   @relation("PositionEmployees", fields: [positionId], references: [id])

    // quan hệ với Department 1-nhân viên thuộc về 1 phòng ban
    departmentId Int        @map("department_id")
    department   Department @relation("DepartmentEmployees", fields: [departmentId], references: [id])

    createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6) // Ngày tạo nhân viên
    createdById     Int?      @map("created_by_id") // ID nhân viên tạo

    updatedAt       DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6) // Ngày cập nhật nhân viên
    updatedById     Int?      @map("updated_by_id") // ID nhân viên cập nhật

    @@index([id])
    @@index([code])
    @@index([fullName])
    @@index([positionId])
    @@map("employees")
    
}

model Position {
    id              Int      @id @default(autoincrement()) @map("id") // ID chức vụ
    uuid            String   @unique @map("uuid") @db.Char(36) // UUID chức vụ
    code            String   @unique @map("code") // Ví dụ: "SUPER_ADMIN", "ADMIN", "STAFF"
    name            String   @map("name") // Tên chức vụ, ví dụ: "Quản trị viên cấp cao", "Trưởng nhóm bán hàng"
    title           String   @map("title") // Ví dụ: "Quản trị cấp cao", "Trưởng nhóm bán hàng"
    level           Int      @default(1) @map("level") // Số càng cao quyền càng lớn

    // Quan hệ 1-N: Một chức vụ có nhiều nhân viên
    employees       Employee[] @relation("PositionEmployees") 

    @@map("positions")
}
