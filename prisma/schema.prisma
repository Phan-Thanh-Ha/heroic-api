generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Districts {
  id             Int      @id @default(autoincrement())
  code           String   @unique @db.Char(3)
  name           String   @db.VarChar(100)
  slug           String   @db.VarChar(100)
  type           String   @db.VarChar(50)
  name_with_type String   @db.VarChar(150)
  path           String?
  path_with_type String?
  province_code  String   @db.Char(2)

  province Provinces @relation(fields: [province_code], references: [code]) // Quan hệ N-1 với Provinces
  wards    Wards[] // Quan hệ 1-N với bảng wards
  customers Customer[] // Quan hệ 1-N với bảng customers

  @@index([province_code])
  @@map("districts")
}

model Provinces {
  id             Int      @id @default(autoincrement())
  code           String   @unique @db.Char(2)
  name           String   @db.VarChar(100)
  slug           String   @db.VarChar(100)
  type           String   @db.VarChar(50)
  name_with_type String   @db.VarChar(150)
  sort_order     Int?
  lat            Float?
  long           Float?
  image          String?  @db.Text


  districts Districts[] // Quan hệ 1-N với bảng districts
  customers Customer[] // Quan hệ 1-N với bảng customers

  @@index([code])
  @@index([name])
  @@index([slug])
  @@index([type])
  @@index([name_with_type])
  @@index([sort_order])
  @@map("provinces")
}

model Wards {
  id             Int      @id @default(autoincrement())
  code           String   @unique @db.Char(5)
  name           String   @db.VarChar(100)
  slug           String   @db.VarChar(100)
  type           String   @db.VarChar(50)
  name_with_type String   @db.VarChar(150)
  path           String?
  path_with_type String?
  district_code  String   @db.Char(3)

  district Districts @relation(fields: [district_code], references: [code]) // Quan hệ N-1 với Districts
  customers Customer[] // Quan hệ 1-N với bảng customers
  
  @@index([code])
  @@index([name])
  @@index([slug])
  @@index([type])
  @@index([name_with_type])
  @@index([path])
  @@index([path_with_type])
  @@index([district_code])
  @@map("wards")
}

model Brand {
    id        Int      @id @default(autoincrement()) @map("id")
    uuid      String   @unique @map("uuid") @db.Char(36)

    name      String   @map("name") @db.VarChar(100)
    slug      String   @unique @map("slug") @db.VarChar(100)
    image     String?  @map("image") @db.Text
    description String?  @map("description") @db.Text
    isActive    Boolean   @default(true) @map("is_active") // Trạng thái hoạt động của danh mục
    
    createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
    createdById Int?     @map("created_by_id") // ID người tạo danh mục

    updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
    updatedById Int?     @map("updated_by_id") // ID người cập nhật danh mục

    featured    FeaturedBrand? // Quan hệ 1-1 với bảng FeaturedBrand

    @@index([id])
    @@index([uuid])
    @@index([name])
    @@index([slug])
    @@index([isActive])
    @@index([createdById])
    @@index([updatedById])
    @@map("brands")
}

model Category {
    id          Int      @id @default(autoincrement()) // ID danh mục
    uuid        String   @unique @map("uuid") @db.Char(36) // UUID danh mục

    name        String   @map("name") @db.VarChar(255) // Tên danh mục
    slug        String   @unique @map("slug") @db.VarChar(255) // Slug danh mục
    banner      String?  @map("banner") @db.Text // Ảnh banner danh mục
    thumbnail   String?  @map("thumbnail") @db.Text // Ảnh thumbnail danh mục
    description String?  @map("description") @db.Text // Mô tả danh mục

    products Product[]    // Quan hệ 1-N với bảng products một danh mục có nhiều sản phẩm

    isActive    Boolean   @default(true) @map("is_active") // Trạng thái hoạt động của danh mục
    isDeleted   Boolean   @default(false) @map("is_deleted") // Trạng thái xóa của danh mục

    createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
    createdById Int?     @map("created_by_id") // ID người tạo danh mục

    updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
    updatedById Int?     @map("updated_by_id") // ID người cập nhật danh mục

    @@map("category")
}

model Customer {
  id              Int       @id @default(autoincrement()) @map("id") // ID khách hàng
  uuid            String    @unique @map("uuid") @db.Char(36) // UUID khách hàng
  customerCode    String    @map("customer_code") @db.Char(50) // Mã khách hàng
  firstName       String?   @map("first_name") @db.VarChar(255) // Tên khách hàng
  lastName        String?   @map("last_name") @db.VarChar(255) // Họ khách hàng
  fullName        String    @map("full_name") @db.VarChar(255) // Tên đầy đủ khách hàng
  avatarUrl       String?   @map("avatar_url") @db.Text // Ảnh đại diện khách hàng
  email           String    @unique @map("email") @db.VarChar(100) // Email khách hàng
  address         String?   @map("address") @db.Text // Địa chỉ khách hàng
  gender          String?   @map("gender") @db.VarChar(10) // Giới tính khách hàng
  typeRegister    String    @map("type_register") @db.VarChar(10) // Loại đăng ký khách hàng
  password        String?   @map("password") @db.VarChar(255) // Mật khẩu khách hàng
  phoneNumber     String?   @map("phone_number") @db.VarChar(20) // Số điện thoại khách hàng
  dateOfBirth     DateTime? @map("date_of_birth") @db.Date // Ngày sinh khách hàng
  loyaltyPoints   Int       @default(0) @map("loyalty_points") // Điểm thưởng khách hàng
  customerGroupId Int?      @map("customer_group_id") // Nhóm khách hàng
  googleId        String?   @map("google_id") @db.Char(255) // Google ID khách hàng
  facebookId      String?   @map("facebook_id") @db.Char(255) // Facebook ID khách hàng
  provinceId      Int?      @map("province_id") // ID tỉnh thành khách hàng
  districtId      Int?      @map("district_id") // ID huyện khách hàng
  wardId          Int?      @map("ward_id") // ID xã phường khách hàng
  otpCode         String?   @map("otp_code") @db.VarChar(10) // Mã OTP khách hàng
  otpExpiredAt    DateTime? @map("otp_expired_at") @db.Timestamptz(6) // Thời gian hết hạn OTP khách hàng
  fullAddress     String?   @map("full_address") @db.Text // Địa chỉ đầy đủ
  discordId       String?   @map("discord_id") @db.Char(255) // Discord ID khách hàng
  telegramId      String?   @map("telegram_id") @db.Char(255) // Telegram ID khách hàng

  province Provinces? @relation(fields: [provinceId], references: [id]) // Quan hệ N-1 với Provinces
  district Districts? @relation(fields: [districtId], references: [id]) // Quan hệ N-1 với Districts
  ward     Wards?     @relation(fields: [wardId], references: [id]) // Quan hệ N-1 với Wards

  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6) // Ngày tạo khách hàng

  @@index([id])
  @@index([customerCode])
  @@index([fullName])
  @@index([provinceId])
  @@index([districtId])
  @@index([wardId])
  @@map("customers")
}

model Department {
    id              Int      @id @default(autoincrement()) @map("id") // ID phòng ban
    uuid            String   @unique @map("uuid") @db.Char(36) // UUID phòng ban
    code            String   @unique @map("code") // Ví dụ: "SALES", "WAREHOUSE", "ACCOUNTING"
    name            String   @map("name") // Ví dụ: "Phòng Kinh Doanh", "Phòng Kho"


    employees Employee[] @relation("DepartmentEmployees") // Quan hệ với bảng Employee nhiều-nhiều 1 phòng ban có nhiều nhân viên
    
    @@map("departments")
}

model Employee {
    id          Int       @id @default(autoincrement()) @map("id") // ID nhân viên
    uuid        String    @unique @map("uuid") @db.Char(36) // UUID nhân viên
    code        String    @unique @map("code") // Mã nhân viên
    avatar      String?   @map("avatar") @db.VarChar(255) // Avatar nhân viên
    fullName    String    @map("full_name") @db.VarChar(255) // Tên đầy đủ nhân viên
    password    String    @map("password") @db.VarChar(255) // Mật khẩu nhân viên
    email       String    @unique @map("email") @db.VarChar(100) // Email nhân viên
    phoneNumber String?   @map("phone") @db.VarChar(20) // Số điện thoại nhân viên
    isActive    Boolean   @default(true) @map("is_active") // Trạng thái hoạt động của nhân viên
    dob         DateTime? @map("dob") @db.Date // Ngày sinh nhân viên

    // Quan hệ với Position 1-nhân viên thuộc về 1 chức vụ
    positionId Int      @map("position_id")
    position   Position @relation("PositionEmployees", fields: [positionId], references: [id])

    // quan hệ với Department 1-nhân viên thuộc về 1 phòng ban
    departmentId Int        @map("department_id")
    department   Department @relation("DepartmentEmployees", fields: [departmentId], references: [id])

    //CCCD
    identity_number    String? @map("identity_number") @db.VarChar(20) // Số CCCD nhân viên
    place_of_origin    String? @map("place_of_origin") @db.VarChar(255) // Quê quán
    place_of_residence String? @map("place_of_residence") @db.VarChar(255) // Nơi ở hiện tại

    cccdNumber  String?  @map("cccd_number") @db.VarChar(20) // Số CCCD nhân viên
    createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6) // Ngày tạo nhân viên
    createdById Int?     @map("created_by_id") // ID nhân viên tạo

    updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6) // Ngày cập nhật nhân viên
    updatedById Int?     @map("updated_by_id") // ID nhân viên cập nhật

    // Quan hệ với Login
    loginId Int?     @map("login_id")
    login   Login?   

    @@index([id])
    @@index([code])
    @@index([fullName])
    @@index([positionId])
    @@map("employees")
}

model FeaturedBrand {
    id           Int     @id @default(autoincrement()) @map("id")
    uuid         String  @unique @map("uuid") @db.Char(36)
    // Nối với bảng Brand
    brandId      Int     @unique @map("brand_id")
    brand        Brand   @relation(fields: [brandId], references: [id])

    // Các trường điều khiển hiển thị
    isActive     Boolean @default(true) @map("is_active") // Bật/Tắt hiển thị
    displayOrder Int     @default(0) @map("display_order") // Thứ tự (0, 1, 2...) để xếp logo


    @@index([brandId])
    @@index([isActive])
    @@index([displayOrder])

    @@map("featured_brands")
}

model LoginDetails {
    id        Int      @id @default(autoincrement())
    loginId   Int      @map("login_id")
    login     Login    @relation(fields: [loginId], references: [id]) // Quan hệ N-1 với Login
    ipAddress String   @map("ip_address") @db.VarChar(255) // IP đăng nhập
    device    String   @map("device") @db.VarChar(255) // Thiết bị đăng nhập
    browser   String   @map("browser") @db.VarChar(255) // Trình duyệt đăng nhập
    os        String   @map("os") @db.VarChar(255) // Hệ điều hành đăng nhập
    country   String   @map("country") @db.VarChar(255) // Quốc gia đăng nhập

    latitude  Float    @map("latitude")                 // Vĩ độ đăng nhập
    longitude Float    @map("longitude")                // Kinh độ đăng nhập
    address   String   @map("address") @db.VarChar(255) // Địa chỉ đăng nhập

    status    String   @map("status") @db.VarChar(255) // Trạng thái đăng nhập
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

    @@index([loginId])
    @@index([createdAt])
    @@map("login_details")
}

model Login {
    id         Int      @id @default(autoincrement()) @map("id")
    uuid       String   @unique @map("uuid")

    employeeId Int      @unique @map("employee_id")
    employee   Employee @relation(fields: [employeeId], references: [id]) // Quan hệ 1-1 với Employee

    employeeCode String   @map("employee_code") // Mã nhân viên
    createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

    // Quan hệ: Một user có thể có nhiều bản ghi login details
    loginDetails LoginDetails[]  // Quan hệ 1-N với LoginDetails

    @@index([uuid])
    @@index([employeeCode])
    @@index([createdAt])
    @@map("logins")
}

model Position {
    id              Int      @id @default(autoincrement()) @map("id") // ID chức vụ
    uuid            String   @unique @map("uuid") @db.Char(36) // UUID chức vụ
    code            String   @unique @map("code") // Ví dụ: "SUPER_ADMIN", "ADMIN", "STAFF"
    name            String   @map("name") // Tên chức vụ, ví dụ: "Quản trị viên cấp cao", "Trưởng nhóm bán hàng"
    title           String   @map("title") // Ví dụ: "Quản trị cấp cao", "Trưởng nhóm bán hàng"
    level           Int      @default(1) @map("level") // Số càng cao quyền càng lớn

    // Quan hệ 1-N: Một chức vụ có nhiều nhân viên
    employees       Employee[] @relation("PositionEmployees") 

    @@map("positions")
}

model Product {
    id          Int      @id @default(autoincrement()) @map("id") // ID sản phẩm
    uuid        String   @unique @map("uuid") @db.Char(36) // UUID sản phẩm
    code        String   @unique @map("code") @db.VarChar(255) // Mã sản phẩm
    name        String   @map("name") @db.VarChar(255) // Tên sản phẩm
    description String?  @map("description") @db.Text // Mô tả sản phẩm

    image       String?  @map("image") @db.Text // Ảnh sản phẩm
    slug        String   @unique @map("slug") @db.VarChar(255) // Slug sản phẩm

    importPrice  Float    @map("import_price") // Giá nhập
    retailPrice  Float    @map("retail_price") // Giá bán lẻ
    discount     Float?   @default(0) @map("discount") // Giảm giá bán (Ví dụ: giảm 50,000đ hoặc 10%) (Tính theo %)

    quantity    Int      @map("quantity") // Số lượng sản phẩm còn lại
    isActive    Boolean   @default(true) @map("is_active") // Trạng thái hoạt động của sản phẩm
    isDeleted   Boolean   @default(false) @map("is_deleted") // Trạng thái xóa của sản phẩm
    isOutOfStock Boolean   @default(false) @map("is_out_of_stock") // Trạng thái hết hàng của sản phẩm
    isFlashSale Boolean   @default(false) @map("is_flash_sale") // Trạng thái flash sale của sản phẩm

    
    createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6) // Ngày tạo sản phẩm
    createdById Int?     @map("created_by_id") // ID người tạo sản phẩm
    updatedById Int?     @map("updated_by_id") // ID người cập nhật sản phẩm
    updatedAt   DateTime? @map("updated_at") @db.Timestamptz(6)

    categoryId Int      @map("category_id")
    category   Category @relation(fields: [categoryId], references: [id]) // Quan hệ N-1 với bảng categories


    @@map("products")
}
